openapi: 3.1.0
info:
  title: API
  version: 1.0.0
servers:
  - url: /api/v1
paths:
  /signup:
    post:
      summary: Sign up
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  examples:
                    - winner1337
                email:
                  type: string
                  examples:
                    - admin@admin.com
                password:
                  type: string
                  examples:
                    - admin
      responses:
        '201':
          description: User successfully registered
        '400':
          description: Incorrect credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: User already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /signin:
    post:
      summary: Sign in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  examples:
                    - admin@admin.com
                password:
                  type: string
                  examples:
                    - admin
      responses:
        '200':
          description: User authenticated
        '400':
          $ref: '#/paths/~1signup/post/responses/400'
        '429':
          $ref: '#/paths/~1signup/post/responses/429'
        '500':
          $ref: '#/paths/~1signup/post/responses/500'
  /refresh-token:
    get:
      summary: Refresh access token
      parameters:
        - name: refreshToken
          in: cookie
          required: true
          description: Refresh token required to update access token
          schema:
            type: string
            format: jwt
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Access token updated
        '401':
          description: Access token can't be updated. Sign-in required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/paths/~1signup/post/responses/429'
        '500':
          $ref: '#/paths/~1signup/post/responses/500'
components:
  schemas:
    ErrorCode:
      type: string
      description: |
        Application specific error codes.
        Prefixes: A - Authentication, S - Signup, L - Login, AT - Access Token, RT - Refresh Token, R - Authorization
      enum:
        - A-1000
        - A-S1001
        - A-L1001
        - A-L1002
        - A-L1003
        - A-AT1001
        - A-AT1002
        - A-RT1001
        - A-RT1002
        - A-R1001
        - A-R1002
        - A-R1003
      x-enum-varnames:
        - INTERNAL_ERROR
        - INVALID_SIGNUP_CREDENTIALS
        - INVALID_LOGIN_CREDENTIALS
        - ACCOUNT_BANNED
        - TOO_MANY_LOGIN_ATTEMPTS
        - ACCESS_TOKEN_EXPIRED
        - ACCESS_TOKEN_INVALID
        - REFRESH_TOKEN_EXPIRED
        - REFRESH_TOKEN_INVALID
        - INSUFFICIENT_PERMISSIONS
        - FORBIDDEN_RESOURCE
        - ROLE_NOT_ALLOWED
      x-enum-descriptions:
        - Internal error
        - Invalid signup credentials
        - Invalid login credentials
        - Account banned
        - Too many login attempts
        - Access token expired
        - Access token signature invalid
        - Refresh token expired
        - Refresh token invalid
        - Insufficient permissions
        - Forbidden resource
        - Role not allowed
    ErrorResponse:
      type: object
      required:
        - code
        - message
        - timestamp
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        message:
          type: string
          description: Human readable error message
          example: Access token expired
        timestamp:
          type: string
          format: date-time
          description: Error occurrence time
        traceId:
          type: string
          description: Unique identifier for log tracing
          example: 6f8c2d1e
