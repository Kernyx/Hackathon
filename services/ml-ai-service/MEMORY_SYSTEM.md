# Система памяти агентов (LSTM-стиль)

## Архитектура

### 1. Краткосрочная память (Short-term Memory)
- Хранит последние 10 сообщений
- Активно используется при генерации ответов
- Автоматически очищается при переполнении
- Аналог "рабочей памяти" в LSTM

### 2. Долгосрочная память (Long-term Memory)
- Хранит до 50 важных воспоминаний
- Используется как контекст для промпта
- Сортируется по важности
- Аналог "постоянной ячейки памяти" в LSTM

### 3. Механизм консолидации памяти
Работает как "ворота" в LSTM:

**Input Gate (Входные ворота):**
- Каждое новое сообщение получает оценку важности (0..1)
- Факторы важности:
  - Собственные сообщения: +0.7
  - Отношения с говорящим: ±0.2
  - Длина сообщения: +0.1 (если >100 символов)

**Forget Gate (Ворота забывания):**
- Когда краткосрочная память переполняется
- Сообщения с важностью >0.6 переносятся в долгосрочную
- Остальные удаляются

**Output Gate (Выходные ворота):**
- При генерации ответа используются:
  - Топ-3 важных воспоминания из долгосрочной памяти
  - Последние N сообщений из краткосрочной памяти

## Хранилище данных

### JSON структура (`data/agent_memory.json`)
```json
{
  "agent_1": {
    "agent_id": "agent_1",
    "last_updated": "2026-02-16T12:00:00",
    "short_term": [
      {
        "tick": 5,
        "speaker": "Борис",
        "text": "Это интересная мысль!",
        "timestamp": "2026-02-16T12:00:05",
        "importance": 0.6,
        "emotion": "neutral"
      }
    ],
    "long_term": [
      {
        "tick": 2,
        "speaker": "Алиса",
        "text": "Я думаю счастье - это поддержка близких",
        "timestamp": "2026-02-16T12:00:02",
        "importance": 0.8,
        "emotion": "neutral"
      }
    ]
  }
}
```

## Преимущества

1. **Персистентность** - память сохраняется между сессиями
2. **Контекстная осведомлённость** - агенты помнят важные моменты
3. **Эффективность** - не перегружаем промпт всей историей
4. **Адаптивность** - важность определяется динамически

## Использование

```python
# Добавить сообщение в память
agent.process_message(tick=5, speaker="Борис", text="Привет!", is_own=False)

# Сохранить память в БД
agent.save_memory()

# Получить контекст для промпта
context = agent.memory_system.format_for_prompt()
```
